{% macro new_paginator(request, props, base) %}
  {% set skip = request.args.get('o')|int if request.args.get('o') else 0 %}
  {% set current_page = (props.count / skip)|round(0, 'ceil')|int if skip != 0 else 1 %}
  {% set max_pages = (props.count / props.limit)|round(0, 'ceil')|int if props.count != 0 else 1 %}

  <div class="paginator">
    <small class="paginator__count">
      {{ 'Total ' ~ props.count ~ ' results' if props.count != 0 else 'No results' }}
    </small>
    <ul class="paginator__pages">
      {% if current_page == 1 %}
        <li class="paginator__page paginator__page--no-link">
          <span class="paginator__link">1</span>
        </li>
      {% else %}
        <li class="paginator__page">
          <a href="{{ url_for(request.endpoint, o = skip - props.limit, **base) }}" class="paginator__link">1</a>
        </li>
      {% endif %}
      
      {% if current_page == 1 %}
        <li class="paginator__page paginator__page--no-link">
          <span class="paginator__link">Previous</span>
        </li>
      {% else %}
        <li class="paginator__page">
          <a href="{{ url_for(request.endpoint, o = skip - props.limit, **base) }}" class="paginator__link">Previous</a>
        </li>
      {% endif %}

      <li class="paginator__page">
        <form class="paginator__selector">
          <label for="page-select" class="form_label paginator__label">Page:</label>
          <input 
            id="page-select" 
            class="form__input form__input--number paginator__number"
            type="number" 
            name="page"
            min="1"
            max="{{ max_pages }}"
            step="1"
            value="{{ current_page }}" 
          >
          <button 
            class="form__button paginator__decrement"
            type="button"
          >
            -1
          </button>
          <button 
            class="form__button paginator__increment"
            type="button"
          >
            +1
          </button>
          <button
            class="form__button form__button--submit paginator__submit" 
            type="submit"
          >
            Go
          </button>
        </form>
      </li>

      {% if current_page == max_pages %}
        <li class="paginator__page paginator__page--no-link">
          <span class="paginator__link">Next</span>
        </li>
      {% else %}
        <li class="paginator__page">
          <a href="{{ url_for(request.endpoint, o = skip + props.limit, **base) }}" class="paginator__link">Next</a>
        </li>
      {% endif %}

      {% if current_page == max_pages %}
        <li class="paginator__page paginator__page--no-link">
          <span class="paginator__link">{{ max_pages }}</span>
        </li>
      {% else %}
        <li class="paginator__page">
          <a href="{{ url_for(request.endpoint, o = skip, **base) }}" class="paginator__link">{{ max_pages }}</a>
        </li>
      {% endif %}
    </ul>
  </div>
{% endmacro %}

{% macro paginator(request, props, base, is_bottom=false) %}
  {% set skip = request.args.get('o')|int if request.args.get('o') else 0 %}
  <div class="paginator {{ 'paginator--bottom' if is_bottom }}">
    <small class="paginator__count">
      Showing {{ skip + 1 }} - {{ skip + props.limit }} of {{ props.count }}
    </small>

    <ul class="paginator__pages">
      {% if skip >= props.limit %}
        <li class="paginator__page">
          <a
            class="paginator__link"
            href="{{ url_for(request.endpoint, o = skip - props.limit, **base) }}" 
          >
            &lt;
          </a>
        </li>
      {% else %}
        <li class="paginator__page paginator__page--no-link">
          &lt;
        </li>
      {% endif %}

      {% if skip >= 100 %}
        <li class="paginator__page">
          <a 
            class="paginator__link" 
            href="{{ url_for(request.endpoint, o = 0, **base) }}"
          >
            1
          </a>
        </li>
        <li>...</li>
      {% endif %}

      {% if skip >= 100 %}
        {% set rng = range((skip / props.limit)|round(0, 'ceil')|int - 2, (skip / props.limit)|round(0, 'ceil')|int + 3) %}
      {% else %}
        {% set rng = range(0, 7) %}
      {% endif %}
      
      {% for page in rng %}
        {% if props.count > page * props.limit %}
          {% if page * props.limit == skip %}
            <li>{{ page + 1 }}</li>
          {% else %}
            <li>
              <a 
                href="{{ url_for(request.endpoint, o = page * props.limit, **base) }}"
              >
                {{ page + 1 }}
              </a>
            </li>
          {% endif %}
        {% endif %}
      {% endfor %}

      {% for page in range(0, (props.count / props.limit)|round(0, 'ceil')|int) %}
        {% if loop.last and props.count - skip >= 100 and props.count > 175 %}
          <li>...</li>
          <li>
            <a 
              href="{{ url_for(request.endpoint, o = page * props.limit, **base) }}"
            >
              {{ (props.count / props.limit)|round(0, 'ceil')|int }}
            </a>
          </li>
        {% endif %}
      {% endfor %}
      

      {% if props.count - skip > props.limit %}
        <li>
          <a 
            href="{{ url_for(request.endpoint, o = skip + props.limit, **base) }}" 
            title="Next page"
          >
            &gt;
          </a>
        </li>
      {% else %}
        <li class="subtitle">&gt;</li>
      {% endif %}
    </ul>
  </div>
{% endmacro %}
